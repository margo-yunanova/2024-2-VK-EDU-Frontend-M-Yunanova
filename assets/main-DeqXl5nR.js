import{v as i,i as h,a as p}from"./mock-CwdIbnRT.js";let s=JSON.parse(localStorage.getItem("chat"));const o=document.querySelector("form"),l=o.querySelector(".form__message"),a=l.querySelector(".form-input"),c=l.querySelector(".form-input-mirror-text"),r=document.querySelector(".messages"),y=document.querySelector("#message-template").content.querySelector(".message"),f=o.querySelector(".icon-send"),m=({type:e,message:t,timestamp:d,status:g})=>{const n=y.cloneNode(!0);if(n.querySelector(".message-text").textContent=t,n.querySelector(".message-time").textContent=new Intl.DateTimeFormat("ru",{hour:"numeric",minute:"numeric"}).format(new Date(d)),e==="input")switch(n.classList.add("message_input"),g){case"read":n.querySelector(".message-status").src=p;break;case"sent":n.querySelector(".message-status").src=h;break}return n},u=e=>{e.preventDefault();const t={id:s.length+1,type:"input",sender:"Бараш",message:a.value,timestamp:new Date,status:"sent"};s.push(t),localStorage.setItem("chat",JSON.stringify(s)),a.value="",c.textContent="",a.style.removeProperty("height"),r.append(m(t)),r.lastElementChild.scrollIntoView({block:"end",behavior:"smooth"})},S=e=>{e.keyCode===13&&!e.shiftKey&&(e.preventDefault(),o.dispatchEvent(new Event("submit")))};o.addEventListener("submit",u);o.addEventListener("keypress",S);f.addEventListener("click",u);a.addEventListener("input",e=>{c.textContent=e.target.value;const t=e.target.value.endsWith(`
`);a.style.height=`calc(${c.offsetHeight}px + ${t?1.15:0}em)`});const v=()=>{(!s||s.length===0)&&(localStorage.setItem("chat",JSON.stringify(i)),s=i);for(const t of s)r.append(m(t));let e=s.findIndex(t=>t.status==="sent"&&t.type==="output");e===-1&&(e=s.length-1),setTimeout(()=>{r.children[e].scrollIntoView({block:"end",behavior:"smooth"})},0)};v();
