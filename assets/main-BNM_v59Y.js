import{v as d,c as m,i as y,a as f}from"./utils-BHrc3vqr.js";let s=JSON.parse(localStorage.getItem("chat"));(!s||s.length===0)&&(localStorage.setItem("chat",JSON.stringify(d)),s=d);const c=document.querySelector("form"),u=c.querySelector(".form__message"),r=u.querySelector(".form-input"),l=u.querySelector(".form-input-mirror-text"),a=document.querySelector(".messages"),v=document.querySelector("#message-template").content.querySelector(".message"),i=c.querySelector(".icon-send"),S=document.querySelector(".arrow-back"),q=document.querySelector(".search"),x=document.querySelector(".menu"),h=({type:e,message:t,timestamp:n,status:p})=>{const o=v.cloneNode(!0);if(o.querySelector(".message-text").textContent=t,o.querySelector(".message-time").textContent=new Intl.DateTimeFormat("ru",{hour:"numeric",minute:"numeric"}).format(new Date(n)),e==="input")switch(o.classList.add("message_input"),p){case"read":o.querySelector(".message-status").src=f;break;case"sent":o.querySelector(".message-status").src=y;break}return o},g=e=>{e.preventDefault();const t=r.value.trim();if(t==="")return;const n={id:s.length+1,type:"input",sender:"Бараш",message:t,timestamp:new Date,status:"sent"};s.push(n),localStorage.setItem("chat",JSON.stringify(s)),r.value="",l.textContent="",i.classList.add("icon-send_disabled"),a.style.removeProperty("height"),r.style.removeProperty("height"),a.append(h(n)),a.lastElementChild.scrollIntoView({block:"end",behavior:"smooth"})},b=e=>{e.keyCode===13&&!e.shiftKey&&(e.preventDefault(),c.dispatchEvent(new Event("submit")))},k=s.findIndex(e=>e.status==="sent"&&e.type==="output");c.addEventListener("submit",g);c.addEventListener("keypress",b);i.addEventListener("click",g);r.addEventListener("input",e=>{const t=e.target.value.trim();if(t===""){i.classList.add("icon-send_disabled"),r.value="";return}i.classList.remove("icon-send_disabled"),l.textContent=t;const n=t.endsWith(`
`);r.style.height=`calc(${l.offsetHeight}px + ${n?1.15:0}em)`,a.style.height=`calc(100dvh - 60px - ${u.offsetHeight}px - 21px - 10px)`});for(const e of s)a.append(h(e));a.children[k].scrollIntoView({block:"end",behavior:"smooth"});q.addEventListener("click",e=>{m(e,()=>{})});x.addEventListener("click",e=>{m(e,()=>{})});S.addEventListener("click",e=>{m(e,()=>{window.location.href="./pages/chats.html"})});
