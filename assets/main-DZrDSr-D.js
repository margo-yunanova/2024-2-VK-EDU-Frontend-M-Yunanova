import{c as u,v as m,i as y,a as f}from"./utils-BN-AizUi.js";let s=JSON.parse(localStorage.getItem("chat"));const a=document.querySelector("form"),d=a.querySelector(".form__message"),r=d.querySelector(".form-input"),l=d.querySelector(".form-input-mirror-text"),c=document.querySelector(".messages"),S=document.querySelector("#message-template").content.querySelector(".message"),i=a.querySelector(".icon-send"),v=document.querySelector(".arrow-back"),q=document.querySelector(".search"),b=document.querySelector(".menu"),g=({type:e,message:t,timestamp:n,status:p})=>{const o=S.cloneNode(!0);if(o.querySelector(".message-text").textContent=t,o.querySelector(".message-time").textContent=new Intl.DateTimeFormat("ru",{hour:"numeric",minute:"numeric"}).format(new Date(n)),e==="input")switch(o.classList.add("message_input"),p){case"read":o.querySelector(".message-status").src=f;break;case"sent":o.querySelector(".message-status").src=y;break}return o},h=e=>{e.preventDefault();const t=r.value.trim();if(t==="")return;const n={id:s.length+1,type:"input",sender:"Бараш",message:t,timestamp:new Date,status:"sent"};s.push(n),localStorage.setItem("chat",JSON.stringify(s)),r.value="",l.textContent="",i.classList.add("icon-send_disabled"),r.style.removeProperty("height"),c.append(g(n)),c.lastElementChild.scrollIntoView({block:"end",behavior:"smooth"})},k=e=>{e.keyCode===13&&!e.shiftKey&&(e.preventDefault(),a.dispatchEvent(new Event("submit")))};a.addEventListener("submit",h);a.addEventListener("keypress",k);i.addEventListener("click",h);q.addEventListener("click",e=>{u(e,()=>{})});b.addEventListener("click",e=>{u(e,()=>{})});v.addEventListener("click",e=>{u(e,()=>{window.location.href="./pages/chats.html"})});r.addEventListener("input",e=>{const t=e.target.value.trim();if(t===""){i.classList.add("icon-send_disabled"),r.value="";return}i.classList.remove("icon-send_disabled"),l.textContent=t;const n=t.endsWith(`
`);r.style.height=`calc(${l.offsetHeight}px + ${n?1.15:0}em)`});const E=()=>{(!s||s.length===0)&&(localStorage.setItem("chat",JSON.stringify(m)),s=m);for(const t of s)c.append(g(t));let e=s.findIndex(t=>t.status==="sent"&&t.type==="output");e===-1&&(e=s.length-1),setTimeout(()=>{c.children[e].scrollIntoView({block:"end",behavior:"smooth"})},0)};E();
